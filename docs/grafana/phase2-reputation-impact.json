{
  "__inputs": [
    {
      "name": "DS_POSTGRESQL",
      "label": "PostgreSQL",
      "description": "PostgreSQL datasource for BetterWorld Phase 2 metrics",
      "type": "datasource",
      "pluginId": "grafana-postgresql-datasource",
      "pluginName": "PostgreSQL"
    }
  ],
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": "-- Grafana --",
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "id": 1,
      "title": "Reputation Distribution Histogram",
      "description": "Distribution of reputation scores across all humans using 20 equal-width buckets from 0 to 10,000.",
      "type": "barchart",
      "gridPos": { "h": 9, "w": 12, "x": 0, "y": 0 },
      "datasource": { "type": "grafana-postgresql-datasource", "uid": "${DS_POSTGRESQL}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "fixed", "fixedColor": "blue" },
          "unit": "short",
          "custom": {
            "fillOpacity": 80,
            "gradientMode": "scheme",
            "lineWidth": 1,
            "axisCenteredZero": false,
            "axisLabel": "Number of Humans"
          }
        },
        "overrides": []
      },
      "options": {
        "orientation": "vertical",
        "barWidth": 0.9,
        "groupWidth": 0.7,
        "legend": { "displayMode": "hidden" },
        "tooltip": { "mode": "single", "sort": "none" },
        "xTickLabelRotation": 0,
        "showValue": "auto"
      },
      "targets": [
        {
          "refId": "A",
          "datasource": { "type": "grafana-postgresql-datasource", "uid": "${DS_POSTGRESQL}" },
          "format": "table",
          "rawSql": "SELECT\n  width_bucket(total_score::float, 0, 10000, 20) AS bucket,\n  COUNT(*) AS count\nFROM reputation_scores\nGROUP BY bucket\nORDER BY bucket",
          "editorMode": "code"
        }
      ]
    },
    {
      "id": 2,
      "title": "Tier Population",
      "description": "Number of humans in each reputation tier: newcomer, contributor, advocate, leader, champion.",
      "type": "piechart",
      "gridPos": { "h": 9, "w": 12, "x": 12, "y": 0 },
      "datasource": { "type": "grafana-postgresql-datasource", "uid": "${DS_POSTGRESQL}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {}
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "newcomer" },
            "properties": [{ "id": "color", "value": { "fixedColor": "semi-dark-blue", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "contributor" },
            "properties": [{ "id": "color", "value": { "fixedColor": "semi-dark-green", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "advocate" },
            "properties": [{ "id": "color", "value": { "fixedColor": "semi-dark-yellow", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "leader" },
            "properties": [{ "id": "color", "value": { "fixedColor": "semi-dark-orange", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "champion" },
            "properties": [{ "id": "color", "value": { "fixedColor": "semi-dark-purple", "mode": "fixed" } }]
          }
        ]
      },
      "options": {
        "legend": { "displayMode": "table", "placement": "right", "values": ["value", "percent"] },
        "pieType": "donut",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": true },
        "tooltip": { "mode": "single", "sort": "none" }
      },
      "targets": [
        {
          "refId": "A",
          "datasource": { "type": "grafana-postgresql-datasource", "uid": "${DS_POSTGRESQL}" },
          "format": "table",
          "rawSql": "SELECT\n  current_tier AS tier,\n  COUNT(*) AS count\nFROM reputation_scores\nGROUP BY current_tier\nORDER BY count DESC",
          "editorMode": "code"
        }
      ]
    },
    {
      "id": 3,
      "title": "Mission Completion Rate (7d)",
      "description": "Hourly count of completed missions over the last 7 days.",
      "type": "timeseries",
      "gridPos": { "h": 9, "w": 12, "x": 0, "y": 9 },
      "datasource": { "type": "grafana-postgresql-datasource", "uid": "${DS_POSTGRESQL}" },
      "fieldConfig": {
        "defaults": {
          "color": { "fixedColor": "green", "mode": "fixed" },
          "unit": "short",
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth",
            "fillOpacity": 20,
            "gradientMode": "scheme",
            "lineWidth": 2,
            "pointSize": 5,
            "showPoints": "auto",
            "spanNulls": false,
            "axisCenteredZero": false,
            "axisLabel": "Completions"
          }
        },
        "overrides": []
      },
      "options": {
        "legend": { "displayMode": "list", "placement": "bottom" },
        "tooltip": { "mode": "single", "sort": "none" }
      },
      "targets": [
        {
          "refId": "A",
          "datasource": { "type": "grafana-postgresql-datasource", "uid": "${DS_POSTGRESQL}" },
          "format": "time_series",
          "rawSql": "SELECT\n  date_trunc('hour', completed_at) AS time,\n  COUNT(*) AS completions\nFROM mission_claims\nWHERE completed_at >= NOW() - INTERVAL '7 days'\n  AND status = 'completed'\nGROUP BY 1\nORDER BY 1",
          "editorMode": "code"
        }
      ]
    },
    {
      "id": 4,
      "title": "Fraud Flags Over Time",
      "description": "Daily fraud events broken down by detection type (phash, velocity, statistical) over the last 30 days.",
      "type": "timeseries",
      "gridPos": { "h": 9, "w": 12, "x": 12, "y": 9 },
      "datasource": { "type": "grafana-postgresql-datasource", "uid": "${DS_POSTGRESQL}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "unit": "short",
          "custom": {
            "drawStyle": "bars",
            "fillOpacity": 80,
            "gradientMode": "none",
            "lineWidth": 1,
            "pointSize": 5,
            "showPoints": "never",
            "spanNulls": false,
            "stacking": { "mode": "normal", "group": "A" },
            "axisCenteredZero": false,
            "axisLabel": "Fraud Events"
          }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "phash_duplicate" },
            "properties": [{ "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "velocity" },
            "properties": [{ "id": "color", "value": { "fixedColor": "orange", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "statistical" },
            "properties": [{ "id": "color", "value": { "fixedColor": "yellow", "mode": "fixed" } }]
          }
        ]
      },
      "options": {
        "legend": { "displayMode": "list", "placement": "bottom" },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "targets": [
        {
          "refId": "A",
          "datasource": { "type": "grafana-postgresql-datasource", "uid": "${DS_POSTGRESQL}" },
          "format": "time_series",
          "rawSql": "SELECT\n  date_trunc('day', created_at) AS time,\n  detection_type,\n  COUNT(*) AS count\nFROM fraud_events\nWHERE created_at >= NOW() - INTERVAL '30 days'\nGROUP BY 1, 2\nORDER BY 1",
          "editorMode": "code"
        }
      ]
    },
    {
      "id": 5,
      "title": "Verification Latency (p50/p95)",
      "description": "Hourly p50 and p95 percentiles of evidence verification processing time in seconds over the last 7 days.",
      "type": "timeseries",
      "gridPos": { "h": 9, "w": 12, "x": 0, "y": 18 },
      "datasource": { "type": "grafana-postgresql-datasource", "uid": "${DS_POSTGRESQL}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "unit": "s",
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth",
            "fillOpacity": 10,
            "gradientMode": "none",
            "lineWidth": 2,
            "pointSize": 5,
            "showPoints": "auto",
            "spanNulls": false,
            "axisCenteredZero": false,
            "axisLabel": "Latency (seconds)"
          }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "p50" },
            "properties": [{ "id": "color", "value": { "fixedColor": "green", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "p95" },
            "properties": [{ "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }]
          }
        ]
      },
      "options": {
        "legend": { "displayMode": "list", "placement": "bottom" },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "targets": [
        {
          "refId": "A",
          "datasource": { "type": "grafana-postgresql-datasource", "uid": "${DS_POSTGRESQL}" },
          "format": "time_series",
          "rawSql": "SELECT\n  date_trunc('hour', updated_at) AS time,\n  percentile_cont(0.5) WITHIN GROUP (ORDER BY EXTRACT(EPOCH FROM (updated_at - created_at))) AS p50,\n  percentile_cont(0.95) WITHIN GROUP (ORDER BY EXTRACT(EPOCH FROM (updated_at - created_at))) AS p95\nFROM evidence\nWHERE updated_at >= NOW() - INTERVAL '7 days'\n  AND status IN ('verified', 'rejected')\nGROUP BY 1\nORDER BY 1",
          "editorMode": "code"
        }
      ]
    },
    {
      "id": 6,
      "title": "Token Distribution Velocity",
      "description": "Hourly total of ImpactTokens distributed as rewards over the last 7 days.",
      "type": "timeseries",
      "gridPos": { "h": 9, "w": 12, "x": 12, "y": 18 },
      "datasource": { "type": "grafana-postgresql-datasource", "uid": "${DS_POSTGRESQL}" },
      "fieldConfig": {
        "defaults": {
          "color": { "fixedColor": "purple", "mode": "fixed" },
          "unit": "short",
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth",
            "fillOpacity": 25,
            "gradientMode": "scheme",
            "lineWidth": 2,
            "pointSize": 5,
            "showPoints": "auto",
            "spanNulls": false,
            "axisCenteredZero": false,
            "axisLabel": "Tokens Distributed"
          }
        },
        "overrides": []
      },
      "options": {
        "legend": { "displayMode": "list", "placement": "bottom" },
        "tooltip": { "mode": "single", "sort": "none" }
      },
      "targets": [
        {
          "refId": "A",
          "datasource": { "type": "grafana-postgresql-datasource", "uid": "${DS_POSTGRESQL}" },
          "format": "time_series",
          "rawSql": "SELECT\n  date_trunc('hour', created_at) AS time,\n  SUM(amount::float) AS tokens_distributed\nFROM token_transactions\nWHERE type = 'reward'\n  AND created_at >= NOW() - INTERVAL '7 days'\nGROUP BY 1\nORDER BY 1",
          "editorMode": "code"
        }
      ]
    }
  ],
  "refresh": "1m",
  "schemaVersion": 39,
  "style": "dark",
  "tags": ["phase2", "reputation", "impact", "fraud", "betterworld"],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-7d",
    "to": "now"
  },
  "timepicker": {
    "refresh_intervals": ["10s", "30s", "1m", "5m", "15m", "30m", "1h"]
  },
  "timezone": "browser",
  "title": "Phase 2: Reputation & Impact",
  "uid": "phase2-reputation-impact",
  "version": 1
}
